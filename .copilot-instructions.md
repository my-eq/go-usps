# USPS Addresses API Go Client - Copilot Instructions

## Project Overview
This is a lightweight, production-grade Go client library for the USPS Addresses 3.0 REST API. The library is designed to be used by millions of people as a critical part of their workflows.

## Core Principles
1. **Lightweight & Clear**: Minimize dependencies and keep the code clear and concise
2. **Strongly Typed**: All data structures are strongly typed based on the OpenAPI specification
3. **Testability**: Code is structured with dependency injection for easy testing
4. **DRY**: Don't Repeat Yourself - common patterns are abstracted
5. **Professional Quality**: Follow Go best practices and idiomatic patterns

## Architecture

### Package Structure
- `usps/` - Main package containing the client and API methods
- `usps/models/` - Strongly-typed data models for requests and responses
- `usps/auth/` - Authentication handling (OAuth)

### Key Components

#### Client (`client.go`)
- Main entry point for API interactions
- Handles base URL configuration (production vs testing)
- Manages HTTP client with proper timeouts
- Delegates authentication to auth provider

#### Authentication (`auth/provider.go`)
- Interface-based design for testability
- OAuth token management
- Automatic token refresh handling

#### Models (`models/`)
- Strongly typed structs matching OpenAPI schemas
- JSON tags for proper serialization
- Validation tags where appropriate
- Separate files for request/response types

#### API Methods
- `GetAddress()` - Address standardization
- `GetCityState()` - City/State lookup by ZIP
- `GetZIPCode()` - ZIP code lookup by address

### Error Handling
- Custom error types for API errors
- Structured error responses matching USPS API format
- HTTP status code handling (400, 401, 403, 404, 429, 503)

### Testing Strategy
- Unit tests for all public methods
- Mock HTTP responses for integration-style tests
- Table-driven tests for edge cases
- 100% coverage goal

## Coding Standards

### Naming Conventions
- Use Go conventions: `GetAddress`, not `get_address`
- Acronyms in caps when appropriate: `HTTPClient`, `USPSClient`, `ZIPCode`
- Clear, descriptive names over brevity

### Documentation
- All exported types, functions, and methods must have godoc comments
- Comments start with the name of the thing being documented
- Include examples in documentation where helpful

### Dependencies
- Minimize external dependencies
- Use standard library where possible
- Only add third-party libraries when absolutely necessary

## Implementation Notes

### OAuth Authentication
- Token is passed via Authorization header: `Bearer {token}`
- Client should accept token provider interface for flexibility
- No token refresh logic in this library (caller's responsibility)

### HTTP Client
- Reasonable timeouts (30 seconds default)
- Proper context support for cancellation
- Retry logic not included (can be added by wrapping the HTTP client)

### Query Parameters
- Use net/url for proper URL encoding
- Validate required parameters before making requests
- Handle optional parameters gracefully

### Response Handling
- Unmarshal JSON responses to strongly-typed structs
- Handle error responses with proper structure
- Preserve raw response for debugging when needed

## Future Considerations
- Rate limiting handling (429 responses)
- Circuit breaker pattern for resilience
- Metrics/observability hooks
- Batch request support if needed
